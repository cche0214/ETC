# ETC车辆查询系统使用指南

## 📋 概述

本系统提供两种车辆查询方式:
1. **高级检索**: 传统精确查询,通过表单填写具体条件
2. **智能查询**: AI自然语言查询,用口语化描述查询需求

---

## 🔍 高级检索

### 查询字段说明

#### 1. 车牌号码
- **精确匹配**: 完全匹配车牌号(如: 苏C12345)
- **模糊匹配**: 包含指定字符的车牌(如: 苏C)
- **前缀匹配**: 以指定字符开头的车牌(如: 苏C1)

#### 2. 车辆类型
- `01` - 大型汽车
- `02` - 小型汽车
- `51` - 挂车
- `52` - 教练车

可多选,空表示查询所有类型

#### 3. 行政区划
- 邳州市
- 丰县
- 睢宁县
- 铜山县
- 高速五大队

#### 4. 道路卡口
- **道路编号**: G3, S250, G104, G311, S251, G518, S325, G310等
- **卡口位置**: K1, K731, K207, K63, K5, K358, K310等

#### 5. 边界级别
- **省际卡口** (PROVINCE): 江苏-山东、江苏-安徽边界
- **市际卡口** (CITY): 徐州市内各区县边界

#### 6. 过车时间
选择日期时间范围,格式: `YYYY-MM-DD HH:mm`

#### 7. 车辆品牌
选填,如: 大众、本田、解放、东风等

#### 8. 方向类型
- **进入** (1): 车辆进入本区域
- **离开** (2): 车辆离开本区域

### 使用示例

**示例1: 查询特定车牌**
```
车牌号码: 苏C12345
匹配类型: 精确匹配
其他字段: 留空
```

**示例2: 查询省际卡口大型车辆**
```
车辆类型: ✓ 大型汽车
边界级别: ◉ 省际卡口
时间范围: 2023-12-01 00:00 至 2023-12-01 23:59
```

**示例3: 查询G3高速今天的所有记录**
```
道路编号: G3
过车时间: 2023-12-07 00:00 至 2023-12-07 23:59
```

---

## 🤖 智能查询

### AI查询模式

1. **智能理解**: 综合理解查询意图,推荐日常使用
2. **语义分析**: 深度分析语义关系,适合复杂查询
3. **上下文**: 结合历史查询上下文,连续查询使用
4. **模式匹配**: 基于模式识别,适合规律性查询

### 自然语言查询示例

#### 基础查询
```
查询昨天的所有车辆记录
今天通过G3高速的车辆
最近7天的小型汽车
```

#### 组合条件查询
```
查询昨天从江苏进入山东的苏C开头小型汽车
最近7天通过G3高速省际卡口的大型货车
邳州市S250卡口今天的所有车辆记录
```

#### 复杂查询
```
查询12月1日8点到18点之间,通过省际卡口的鲁Q牌照大型汽车
查找最近一周内,从江苏离开到安徽的所有挂车记录
统计今天各个卡口通过的小型汽车数量
```

### AI理解能力

AI能够识别:
- ✅ 车牌号码前缀 (苏C, 鲁Q, 皖L等)
- ✅ 车辆类型 (小型/大型/挂车/教练车)
- ✅ 时间表达 (今天/昨天/最近N天/具体日期)
- ✅ 地点信息 (行政区划、道路、边界)
- ✅ 方向描述 (进入/离开/通过)
- ✅ 边界级别 (省际/市际)

### 过滤选项

- **时间范围**: 今天/昨天/最近7天/最近30天/自定义
- **结果数量**: 50/100/500/1000条
- **排序方式**: 时间倒序/时间正序/相关度

---

## 📊 查询结果

### 表格视图
显示完整的车辆通行记录,包含所有字段信息

**字段说明:**
- **序号**: 结果序号
- **车牌号码**: HPHM字段,高亮显示
- **车辆类型**: HPZL_LABEL (大型汽车/小型汽车等)
- **过车时间**: GCSJ (格式: YYYY-MM-DD HH:mm:ss)
- **行政区划**: XZQHMC
- **道路卡口**: CLEAN_KKMC (如: G3-K731-省际卡口)
- **边界级别**: BOUNDARY_LEVEL (省际/市际)
- **方向**: FXLX (进入/离开)
- **品牌**: BRAND

### 卡片视图
以卡片形式展示,适合浏览和对比

每张卡片显示:
- 车牌号码 (标题)
- 边界级别标签
- 车辆类型、过车时间
- 卡口位置、行政区划
- 方向类型

### 操作功能

1. **查看详情**: 点击查看单条记录的完整信息
2. **切换视图**: 在表格视图和卡片视图之间切换
3. **导出结果**: 导出查询结果为Excel/CSV/JSON文件
4. **分页浏览**: 支持分页查看大量结果

---

## 🔧 数据字段完整说明

### CSV数据格式

```csv
GCXH,XZQHMC,ROAD_ID,K_INDEX,BOUNDARY_LEVEL,BOUNDARY_DETAIL,BOUNDARY_LABEL,CLEAN_KKMC,FXLX,GCSJ,GCSJ_TS,GCSJ_MQ,HPZL,HPZL_LABEL,HPHM,BRAND
```

| 字段名 | 说明 | 示例 |
|--------|------|------|
| GCXH | 过车序号 | 320300108805919450 |
| XZQHMC | 行政区划名称 | 邳州市 |
| ROAD_ID | 道路编号 | G3, S250 |
| K_INDEX | 卡口桩号 | K1, K731 |
| BOUNDARY_LEVEL | 边界级别 | PROVINCE, CITY |
| BOUNDARY_DETAIL | 边界详情 | 江苏-山东 |
| BOUNDARY_LABEL | 边界标签 | 苏鲁界 |
| CLEAN_KKMC | 卡口名称 | G3-K731-省际卡口 |
| FXLX | 方向类型 | 1(进入), 2(离开) |
| GCSJ | 过车时间 | 2023-12-01 08:15:30 |
| GCSJ_TS | 时间戳(毫秒) | 1701388530000 |
| GCSJ_MQ | 时间(秒精度) | 2023-12-01 08:15:30 |
| HPZL | 号牌种类代码 | 01, 02, 51, 52 |
| HPZL_LABEL | 号牌种类标签 | 大型汽车 |
| HPHM | 号牌号码 | 苏C12345 |
| BRAND | 车辆品牌 | 大众 |

---

## 🚀 后端集成说明

### API接口定义

所有API已在 `src/api/vehicleSearch.js` 中定义,包含:

#### 1. 高级检索接口
```javascript
searchVehicles(params)
```

**请求参数:**
```javascript
{
  plateNumber: '苏C12345',      // 车牌号
  plateMatchType: 'exact',      // 匹配类型
  vehicleTypes: ['01', '02'],   // 车辆类型数组
  district: '邳州市',            // 行政区划
  roadId: 'G3',                 // 道路编号
  kIndex: 'K731',               // 卡口位置
  boundaryLevel: 'PROVINCE',    // 边界级别
  startTime: '2023-12-01 00:00:00',
  endTime: '2023-12-01 23:59:59',
  brand: '大众',                 // 车辆品牌
  direction: '1',               // 方向类型
  page: 1,
  pageSize: 20
}
```

**响应格式:**
```javascript
{
  code: 200,
  message: '查询成功',
  data: {
    total: 127,
    page: 1,
    pageSize: 20,
    data: [...]  // 车辆记录数组
  }
}
```

#### 2. AI智能查询接口
```javascript
aiSearchVehicles(params)
```

**请求参数:**
```javascript
{
  query: '查询昨天从江苏进入山东的苏C开头小型汽车',
  mode: 'intelligent',
  timeRange: 'yesterday',
  limit: 100,
  sortBy: 'time_desc'
}
```

**响应格式:**
```javascript
{
  code: 200,
  message: 'AI查询成功',
  data: {
    parsedConditions: {
      '车牌号码': '苏C开头',
      '车辆类型': '小型汽车',
      '时间范围': '昨天',
      ...
    },
    results: {
      total: 85,
      page: 1,
      pageSize: 100,
      data: [...]  // 包含relevance相关度评分
    }
  }
}
```

#### 3. 其他接口

- `getSearchSuggestions(keyword)` - 搜索建议
- `getHotKeywords()` - 热门关键词
- `getVehicleDetail(gcxh)` - 车辆详情
- `exportResults(params, format)` - 导出结果
- `getStatistics(params)` - 统计信息

### 后端开发注意事项

1. **数据库查询优化**
   - 在 HPHM, GCSJ, ROAD_ID, BOUNDARY_LEVEL 字段上建立索引
   - 使用时间分区表提升查询性能
   - 车牌模糊查询使用前缀索引

2. **AI自然语言处理**
   - 后端需实现NLP解析引擎或调用AI服务
   - 提取实体: 车牌、时间、地点、类型等
   - 构建SQL查询或NoSQL查询条件

3. **大数据量处理**
   - 使用流式导出处理大量数据
   - 限制单次查询结果上限(建议≤10000条)
   - 实现异步导出任务,返回任务ID供轮询

4. **性能建议**
   - 缓存热门查询结果
   - 使用Elasticsearch进行全文检索
   - 实现查询结果分页缓存

---

## 💡 使用技巧

1. **组合查询**: 多个条件同时使用可精确定位目标车辆
2. **模糊查询**: 不确定完整信息时使用模糊/前缀匹配
3. **时间筛选**: 缩小时间范围可提升查询速度
4. **AI查询**: 口语化描述需求,AI自动理解并转换为查询条件
5. **结果导出**: 大量数据建议导出后使用Excel分析

---

## 📞 技术支持

如有问题请联系开发团队或查看项目文档。

**项目路径**: `c:\unisversity\数据存储与管理\visualization\etc-visualization`

**数据来源**: `data_all/202312/` 和 `data_all/202401/` 目录
