# ETC 高速公路大数据项目  
## 数据体系与数据库架构设计说明（RAG 核心知识文档）

---

## 1. 项目背景

本项目为高速公路 ETC 大数据管理与监控系统，围绕多源、跨月、质量不一致的过车数据，构建完整的数据采集、清洗、存储、计算与智能分析体系。  
系统服务对象包括：实时监控、业务统计、智能查询与预测分析。

---

## 2. 数据来源与原始结构

### 2.1 数据形式

- CSV 文件，按日期分文件
- 不同月份存在字段缺失、时间异常、数据污染

### 2.2 原始字段（8 类）

| 字段 | 含义 |
|----|----|
| GCXH | 过车序号（唯一） |
| XZQHMC | 行政区划 |
| KKMC | 原始卡口名称 |
| FXLX | 行车方向 |
| GCSJ | 过车时间 |
| HPZL | 号牌种类 |
| HPHM | 车牌号 |
| CLPPXH | 车辆品牌型号 |

---

## 3. 数据清洗与标准化规则

### 3.1 唯一标识

- GCXH 无缺失，作为最终唯一标识的一部分

### 3.2 行政区划（XZQHMC）

固定 7 个取值：  
睢宁县、邳州市、丰县、沛县、铜山县、新沂市、高速五大队

用于：
- 分库
- 区域统计
- 查询过滤

---

### 3.3 卡口字段重构（核心）

原始 KKMC 不可直接使用，重构为：

| 字段 | 含义 |
|----|----|
| ROAD_ID | 道路编号 |
| K_INDEX | K 值 |
| BOUNDARY_LEVEL | 省际 / 市际 |
| BOUNDARY_DETAIL | 交界描述 |
| BOUNDARY_LABEL | 交界标签 |
| CLEAN_KKMC | 唯一卡口编号 |

核心业务结论：  
**ROAD_ID + K_INDEX 可唯一确定卡口**

---

### 3.4 行车方向（FXLX）

- 取值 1 / 2
- 1 表示进入徐州，2 表示离开徐州
- FXLX=2 的记录全部来自睢宁县
- 用于分析，不参与分片

---

### 3.5 时间字段与时间戳

原始时间字符串表示 **北京时间**。  
必须显式指定 Asia/Shanghai 时区再转换为时间戳，否则会产生 8 小时偏差。

最终字段：

- GCSJ：标准时间字符串
- GCSJ_TS：毫秒级 Unix 时间戳

---

### 3.6 号牌种类（HPZL）

统一规范为 7 类：

01 大型汽车  
02 小型汽车  
13 外籍汽车  
22 港澳车辆  
51 挂车  
52 教练车  
未知（原 '-'）

---

### 3.7 车牌号（HPHM）

- 正则校验
- 非法直接丢弃
- 合法格式脱敏为：苏CD7***

---

### 3.8 车辆品牌字段

CLPPXH 拆分为：

- BRAND（品牌）
- MODEL（车型）
- YEAR（年款）

异常值统一映射为“未知”。

---

## 4. 存储与计算架构设计

### 4.1 三类计算模式

| 模式 | 技术 | 数据 |
|----|----|----|
| 流式计算 | Flink | 实时 |
| 离线计算 | 批处理 | 历史 |
| 交互查询 | SQL / LLM | 结构化 |

---

### 4.2 HBase（流式结果）

- 写入 Flink 实时流
- RowKey：

<reverse_ts>-<HPHM>-<CLEAN_KKMC>-<GCXH>

支持：
- 最新数据优先
- 车牌轨迹查询

---

### 4.3 MySQL + 中间件（交互查询）

#### 分库规则（按行政区）

- node1：睢宁县、丰县、高速五大队
- node2：新沂市、邳州市
- node3：铜山县、沛县

#### 分表规则（按车牌）

hash(HPHM) % 4 → etc_records_0 ~ etc_records_3

逻辑表：

TRAFFIC.etc_records

---

### 4.4 索引设计（必须）

- idx_hphm(HPHM)
- idx_time(GCSJ_TS)
- idx_area(XZQHMC)

---

## 5. 技术结论总结

1. 数据必须先严格清洗再进入系统
2. 行政区划天然适合做分库键
3. 车牌号适合做分表键
4. 流处理负责 HBase
5. 交互查询走 MySQL + 中间件
6. RAG 系统直接基于结构化知识构建

---

## 6. 文档用途说明

本文件作为：

- 项目第一份核心知识文档
- RAG 知识库基础材料
- 系统架构说明文档

